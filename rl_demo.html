<!DOCTYPE html>
<html>
<head>
    <title>Law Agent - Advanced RL System Demo</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .header { text-align: center; color: #2c3e50; margin-bottom: 30px; }
        .demo-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .metrics { display: flex; justify-content: space-around; margin: 20px 0; flex-wrap: wrap; }
        .metric { text-align: center; padding: 15px; background: #ecf0f1; border-radius: 5px; margin: 5px; min-width: 150px; }
        .metric h3 { margin: 0 0 10px 0; color: #2c3e50; }
        .metric-value { font-size: 24px; font-weight: bold; color: #3498db; }
        .question { background: #3498db; color: white; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .response { background: #2ecc71; color: white; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .feedback { background: #e74c3c; color: white; padding: 5px 10px; border-radius: 3px; margin: 5px; border: none; cursor: pointer; }
        .learning { background: #f39c12; color: white; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .progress-bar { width: 100%; background: #ddd; border-radius: 10px; overflow: hidden; margin: 10px 0; }
        .progress { height: 20px; background: #4CAF50; transition: width 0.3s; }
        button { background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        input[type="text"] { padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .highlight { background: #fff3cd; padding: 10px; border-radius: 5px; margin: 10px 0; border-left: 4px solid #ffc107; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Integrated Law Agent - Ultimate AI Legal Assistant</h1>
            <p>Advanced RL Learning + ML Classification + Constitutional Backing</p>
            <div class="highlight">
                <strong>üéØ Enhanced Features:</strong>
                ML-driven domain classification, Constitutional article backing, Real-time RL learning, Enhanced legal reasoning
            </div>
        </div>
        
        <div class="demo-section">
            <h2>Real-Time Learning Metrics</h2>
            <div class="metrics">
                <div class="metric">
                    <h3>Confidence Score</h3>
                    <div class="metric-value" id="confidence">---%</div>
                    <div class="progress-bar">
                        <div class="progress" id="confidence-bar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="metric">
                    <h3>User Satisfaction</h3>
                    <div class="metric-value" id="satisfaction">---</div>
                    <div class="progress-bar">
                        <div class="progress" id="satisfaction-bar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="metric">
                    <h3>Learning States</h3>
                    <div class="metric-value" id="qtable">0</div>
                    <small>Q-table Size</small>
                </div>
                <div class="metric">
                    <h3>Exploration Rate</h3>
                    <div class="metric-value" id="exploration">0.100</div>
                    <small>Decreases as AI learns</small>
                </div>
                <div class="metric">
                    <h3>ML Classification</h3>
                    <div class="metric-value" id="ml-status">ü§ñ Active</div>
                    <small>TF-IDF + Naive Bayes</small>
                </div>
                <div class="metric">
                    <h3>Constitutional Support</h3>
                    <div class="metric-value" id="constitutional-status">üèõÔ∏è Active</div>
                    <small>Indian Constitution</small>
                </div>
            </div>
        </div>
        
        <div class="demo-section">
            <h2>Interactive Demo - Ask Legal Questions</h2>
            <div style="margin-bottom: 15px;">
                <input type="text" id="question" placeholder="Ask a legal question" style="width: 70%; margin-right: 10px;">
                <button onclick="askQuestion()">Ask Question</button>
                <button onclick="clearConversation()">Clear</button>
            </div>
            <div class="highlight">
                <strong>Watch for:</strong> Confidence percentages increasing, better domain classification, learning rewards from feedback
            </div>
            <div id="conversation"></div>
        </div>
        
        <div class="demo-section">
            <h2>Learning Progress Log</h2>
            <div id="learning-log">
                <p><em>Learning events will appear here as you interact with the system...</em></p>
            </div>
        </div>
    </div>
    
    <script>
        let sessionId = null;
        
        // Initialize session
        async function initSession() {
            try {
                const response = await fetch('http://localhost:8000/api/v1/sessions', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({user_id: 'web_demo', user_type: 'common_person'})
                });
                const data = await response.json();
                sessionId = data.session_id;
                updateMetrics();
            } catch (error) {
                console.error('Session creation failed:', error);
            }
        }
        
        // Update metrics
        async function updateMetrics() {
            try {
                const response = await fetch('http://localhost:8000/api/v1/rl/status');
                const data = await response.json();
                
                document.getElementById('qtable').textContent = data.q_table_size || 0;
                document.getElementById('exploration').textContent = 
                    (data.learning_metrics?.exploration_rate || 0.1).toFixed(4);
                
                if (sessionId) {
                    const sessionResponse = await fetch(`http://localhost:8000/api/v1/sessions/${sessionId}/summary`);
                    const sessionData = await sessionResponse.json();
                    
                    const confidence = sessionData.average_confidence || 0;
                    const satisfaction = sessionData.satisfaction_score || 0;
                    
                    document.getElementById('confidence').textContent = (confidence * 100).toFixed(1) + '%';
                    document.getElementById('satisfaction').textContent = satisfaction.toFixed(3);
                    
                    document.getElementById('confidence-bar').style.width = (confidence * 100) + '%';
                    document.getElementById('satisfaction-bar').style.width = ((satisfaction + 1) * 50) + '%';
                }
            } catch (error) {
                console.error('Metrics update failed:', error);
            }
        }
        
        // Ask question
        async function askQuestion() {
            const question = document.getElementById('question').value;
            if (!question || !sessionId) return;
            
            const conversation = document.getElementById('conversation');
            conversation.innerHTML += `<div class="question">You: ${question}</div>`;
            
            try {
                const response = await fetch('http://localhost:8000/api/v1/query', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        session_id: sessionId,
                        query: question,
                        interaction_type: 'query'
                    })
                });
                
                const data = await response.json();
                
                // Enhanced response display with constitutional backing
                let responseText = data.response?.text || data.response || 'Legal advice provided';
                let enhancedFeatures = '';

                // Show enhanced ML classification
                if (data.response?.legal_analysis?.enhanced_ml_classification) {
                    enhancedFeatures += ' ü§ñ ML-Enhanced';
                }

                // Show constitutional backing
                if (data.response?.constitutional_backing?.article_count > 0) {
                    enhancedFeatures += ` üèõÔ∏è Constitutional (${data.response.constitutional_backing.article_count} articles)`;
                }

                conversation.innerHTML += `
                    <div class="response">
                        AI Response: ${responseText}
                        <br><small><strong>Domain:</strong> ${data.domain} | <strong>Confidence:</strong> ${(data.confidence * 100).toFixed(1)}%${enhancedFeatures}</small>
                        ${data.response?.constitutional_backing?.constitutional_basis ?
                            `<br><div style="background: rgba(255,255,255,0.2); padding: 8px; margin-top: 8px; border-radius: 3px;">
                                <strong>Constitutional Basis:</strong> ${data.response.constitutional_backing.constitutional_basis.substring(0, 200)}...
                            </div>` : ''}
                    </div>
                `;
                
                conversation.innerHTML += `
                    <div style="margin: 10px 0;">
                        <button class="feedback" onclick="provideFeedback('${data.interaction_id}', 'upvote')">Good</button>
                        <button class="feedback" onclick="provideFeedback('${data.interaction_id}', 'downvote')">Bad</button>
                    </div>
                `;
                
                updateMetrics();
                
            } catch (error) {
                console.error('Query failed:', error);
            }
            
            document.getElementById('question').value = '';
        }
        
        // Provide feedback
        async function provideFeedback(interactionId, feedback) {
            try {
                const response = await fetch('http://localhost:8000/api/v1/feedback', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        session_id: sessionId,
                        interaction_id: interactionId,
                        feedback: feedback,
                        time_spent: 30.0
                    })
                });
                
                const data = await response.json();
                
                const learningLog = document.getElementById('learning-log');
                const rewardText = data.reward > 0 ? 'Positive learning!' : 'Adjusting approach...';
                
                learningLog.innerHTML = `
                    <div class="learning">
                        <strong>Learning Update:</strong> Reward = ${data.reward?.toFixed(3)}, 
                        Satisfaction = ${data.updated_satisfaction?.toFixed(3)} - ${rewardText}
                    </div>
                ` + learningLog.innerHTML;
                
                updateMetrics();
                
                event.target.parentElement.innerHTML = `<small>Feedback recorded: ${feedback}</small>`;
                
            } catch (error) {
                console.error('Feedback failed:', error);
            }
        }
        
        function clearConversation() {
            document.getElementById('conversation').innerHTML = '';
            document.getElementById('learning-log').innerHTML = '<p><em>Learning events will appear here...</em></p>';
        }
        
        setInterval(updateMetrics, 10000);
        window.onload = initSession;
        
        document.getElementById('question').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') askQuestion();
        });
    </script>
</body>
</html>
